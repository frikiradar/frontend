<ion-header class="ion-no-border">
  <ion-toolbar *ngIf="!reorderActive">
    <ion-buttons slot="start">
      <ion-menu-toggle>
        <ion-avatar>
          <img
            [src]="auth.currentUserValue?.thumbnail"
            [alt]="auth.currentUserValue?.username"
            default="/assets/img/users/default.jpg"
          />
        </ion-avatar>
      </ion-menu-toggle>
    </ion-buttons>
    <ion-title>Comunidad</ion-title>
  </ion-toolbar>
  <ion-toolbar *ngIf="reorderActive">
    <ion-buttons slot="end">
      <ion-button (click)="reorderActive = false">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-item lines="none" (click)="showAllStories()" button>
    <ion-label color="light">
      <h2 class="section">Historias de los usuarios</h2>
    </ion-label>
    <ion-icon name="arrow-forward" slot="end" color="light"></ion-icon>
  </ion-item>
  <div *ngIf="!stories">
    <ion-slides [options]="storiesOpts">
      <ion-slide *ngFor="let i of [].constructor(8)">
        <div>
          <ion-avatar>
            <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
          </ion-avatar>
          <ion-label>
            <ion-skeleton-text animated></ion-skeleton-text>
          </ion-label>
        </div>
      </ion-slide>
    </ion-slides>
  </div>
  <ion-slides
    #storiesSlides
    id="stories"
    [options]="storiesOpts"
    *ngIf="stories"
  >
    <ion-slide>
      <div>
        <ion-item button lines="none" (click)="newStory()">
          <ion-avatar>
            <img
              [src]="auth.currentUserValue?.thumbnail"
              alt="auth.currentUserValue?.name"
            />
            <ion-badge color="tertiary">+</ion-badge>
          </ion-avatar>
        </ion-item>
        <ion-label>Añadir historia</ion-label>
      </div>
    </ion-slide>
    <ion-slide *ngFor="let story of groupedStories; let i = index">
      <div>
        <ion-item button lines="none" (click)="showStories(story.user.id)">
          <ion-avatar [ngClass]="story?.viewed ? '' : 'not-view'">
            <img [src]="story.image" [alt]="story.text" />
          </ion-avatar>
        </ion-item>
        <ion-label>{{story.user.username}}</ion-label>
      </div>
    </ion-slide>
  </ion-slides>

  <ion-item lines="none">
    <ion-label>
      <h2 class="section">Salas de chat</h2>
      <p class="subtitle">
        ¡Entra y habla con la comunidad FrikiRadar!
      </p>
    </ion-label>
  </ion-item>
  <div *ngIf="!rooms" id="rooms">
    <ion-item *ngFor="let i of [].constructor(8)">
      <ion-thumbnail>
        <ion-skeleton-text animated></ion-skeleton-text>
      </ion-thumbnail>
      <ion-label>
        <h2 class="room-name">
          <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
        </h2>
        <p class="room-description">
          <ion-skeleton-text animated></ion-skeleton-text>
        </p>
      </ion-label>
    </ion-item>
  </div>
  <div *ngIf="rooms" id="rooms">
    <ion-reorder-group
      [disabled]="!reorderActive"
      (ionItemReorder)="reorderRooms($event)"
    >
      <ion-item
        button
        lines="none"
        (click)="showRoom(room.slug)"
        *ngFor="let room of rooms"
        (press)="activateOptions()"
      >
        <ion-thumbnail>
          <img [src]="room.image" [alt]="room.name" />
          <ion-badge color="primary" *ngIf="room?.unread">&nbsp;</ion-badge>
        </ion-thumbnail>
        <ion-label>
          <h2 class="room-name" [ngClass]="room?.unread ? 'unread' : ''">
            {{ room?.name }}
          </h2>
          <p class="room-description">{{room?.description}}</p>
        </ion-label>
        <ion-reorder slot="end" (click)="vibration.vibrate(5)">
          <ion-icon size="large" color="light" name="reorder-two"></ion-icon>
        </ion-reorder>
      </ion-item>
    </ion-reorder-group>
  </div>

  <!--<ion-label>
    <h2 class="section">Eventos</h2>
    <p class="subtitle">
      Próximamente
    </p>
  </ion-label>-->

  <!--<div class="full-center ion-padding">
    <ion-icon name="people-outline"></ion-icon>
    <h2>Próximamente</h2>
    <p>
      Regresa aquí más adelante para disfrutar de todo lo que FrikiRadar te
      puede ofrecer.
    </p>
  </div>-->
</ion-content>
