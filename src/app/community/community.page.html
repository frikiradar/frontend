<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-toggle>
        <ion-avatar>
          <img
            [src]="auth.currentUserValue?.thumbnail"
            [alt]="auth.currentUserValue?.username"
            default="/assets/img/users/default.jpg"
          />
        </ion-avatar>
      </ion-menu-toggle>
    </ion-buttons>
    <ion-title>Comunidad</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-progress-bar type="indeterminate" *ngIf="loading"></ion-progress-bar>

  <ion-item lines="none" (click)="showAllStories()" button detail="false">
    <ion-label color="light">
      <h2 class="section">Historias frikis</h2>
    </ion-label>
    <ion-icon
      md="arrow-forward"
      ios="chevron-forward"
      slot="end"
      color="light"
    ></ion-icon>
  </ion-item>
  <section>
    <ion-slides
      id="stories"
      class="ion-padding"
      [options]="storiesOpts"
      mode="md"
    >
      <ion-slide>
        <div>
          <ion-item button lines="none" (click)="newStory()">
            <ion-avatar>
              <img
                [src]="auth.currentUserValue?.thumbnail"
                alt="auth.currentUserValue?.name"
              />
              <ion-badge color="tertiary">+</ion-badge>
            </ion-avatar>
          </ion-item>
          <ion-label>Añadir historia</ion-label>
        </div>
      </ion-slide>
      <ion-slide *ngFor="let story of groupedStories; let i = index">
        <div>
          <ion-item button lines="none" (click)="showStories(story.user.id)">
            <ion-avatar [ngClass]="story?.viewed ? '' : 'not-view'">
              <img [src]="story.image" [alt]="story.text" />
            </ion-avatar>
          </ion-item>
          <ion-label>{{story.user.username}}</ion-label>
        </div>
      </ion-slide>
    </ion-slides>
  </section>

  <ion-item lines="none" (click)="showAllRooms()" button detail="false">
    <ion-label color="light">
      <h2 class="section">Salas de chat</h2>
      <p class="subtitle">
        ¡Entra y habla con la comunidad FrikiRadar!
      </p>
    </ion-label>
    <ion-icon
      md="arrow-forward"
      ios="chevron-forward"
      slot="end"
      color="light"
    ></ion-icon>
  </ion-item>
  <section id="rooms">
    <div *ngIf="!rooms">
      <ion-item *ngFor="let i of [].constructor(3)" lines="none">
        <ion-thumbnail>
          <ion-skeleton-text animated></ion-skeleton-text>
        </ion-thumbnail>
        <ion-label>
          <h2 class="room-name">
            <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
          </h2>
          <p class="room-description">
            <ion-skeleton-text animated></ion-skeleton-text>
          </p>
        </ion-label>
      </ion-item>
    </div>
    <div *ngIf="rooms">
      <ion-item
        button
        lines="none"
        (click)="showRoom(room.slug)"
        *ngFor="let room of rooms.slice(0,3)"
      >
        <ion-thumbnail>
          <ion-img
            [src]="room.image ? room.image : '/assets/img/pages/default-games-page.jpg'"
            [alt]="room.name"
          ></ion-img>
          <ion-badge color="primary" *ngIf="room?.unread">&nbsp;</ion-badge>
        </ion-thumbnail>
        <ion-label>
          <h2 class="room-name" [ngClass]="room?.unread ? 'unread' : ''">
            {{ room?.name }}
          </h2>
          <p class="room-description">{{room?.description}}</p>
        </ion-label>
      </ion-item>
    </div>
    <ion-item button lines="none" class="show-more" (click)="showAllRooms()">
      <ion-label>Ver las {{rooms?.length}} salas</ion-label>
    </ion-item>
  </section>

  <ion-item
    lines="none"
    (click)="showPages()"
    button
    detail="false"
    *ngIf="pages"
  >
    <ion-label color="light">
      <h2 class="section">Páginas</h2>
      <p class="subtitle">
        Basadas en tus etiquetas de gustos
      </p>
    </ion-label>
    <ion-icon
      md="arrow-forward"
      ios="chevron-forward"
      slot="end"
      color="light"
    ></ion-icon>
  </ion-item>
  <section id="pages">
    <ion-slides [options]="pagesOpts" mode="md">
      <ion-slide *ngFor="let page of pages">
        <div>
          <ion-item button lines="none" (click)="showPage(page.slug)">
            <ion-thumbnail>
              <img
                [src]="page.cover"
                [alt]="page.name"
                default="/assets/img/pages/default-games-page.jpg"
              />
            </ion-thumbnail>
          </ion-item>
          <ion-label>{{page.name}}</ion-label>
        </div>
      </ion-slide>
    </ion-slides>
  </section>
</ion-content>
