<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-toggle (click)="menu.open()">
        <ion-avatar>
          <img
            [src]="authUser?.thumbnail"
            [alt]="authUser?.username"
            default="/assets/img/users/default.jpg"
          />
        </ion-avatar>
      </ion-menu-toggle>
    </ion-buttons>
    <ion-title>Radar</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="changeView()" *ngIf="!showSkeleton">
        <ion-icon
          slot="icon-only"
          [name]="view === 'cards' ? 'list' : 'albums'"
        ></ion-icon>
      </ion-button>
      <ion-button (click)="search()">
        <ion-icon slot="icon-only" name="search"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content #radarlist [scrollEvents]="true" (ionScroll)="onScroll($event)">
  <div *ngIf="view === 'cards'; else listView" style="height: 100%;">
    <ion-slides #slides (ionSlideDidChange)="slide()" [options]="slideOpts">
      <ion-slide *ngIf="showSkeleton; else radarItems">
        <ion-card>
          <ion-card-header>
            <ion-skeleton-text
              animated
              style="height: 400px; width: 100%"
            ></ion-skeleton-text>
            <ion-card-title>
              <ion-skeleton-text
                animated
                style="height: 20px; width: 50%"
              ></ion-skeleton-text>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content
            ><p>
              <ion-skeleton-text
                animated
                style="width: 100%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 100%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 100%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 50%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 50%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 50%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 80%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 100%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                animated
                style="width: 100%"
              ></ion-skeleton-text>
            </p>
          </ion-card-content>
        </ion-card>
      </ion-slide>
      <ng-template #radarItems>
        <ion-slide *ngFor="let user of users;">
          <ion-card (click)="showProfile(user.id)">
            <img
              [src]="user?.avatar"
              [alt]="users?.username"
              default="/assets/img/users/default.jpg"
            />
            <div class="match full-center">{{ user.match }}%</div>
            <ion-card-header>
              <ion-card-title>
                <ion-badge
                  *ngIf="(user?.last_login | niceDate) === 'Ahora mismo'"
                  color="secondary"
                  >&nbsp;</ion-badge
                >
                <span class="name">{{ user.name }}</span>
                <span class="age">, {{ user.age }}</span>
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <h3 class="location" *ngIf="user?.distance !== undefined">
                <ion-icon
                  name="location-sharp"
                  slot="start"
                  size="xs"
                  color="primary"
                ></ion-icon>
                <span>A {{ user?.distance }}km de distancia</span>
              </h3>
              <p class="description">{{user.description}}</p>
              <div class="tags" *ngIf="user.common_tags.length">
                <p>Gustos en común:</p>
                <ion-chip
                  *ngFor="let tag of user.common_tags"
                  color="secondary"
                >
                  <ion-label>{{ tag }}</ion-label>
                </ion-chip>
              </div></ion-card-content
            >
          </ion-card>
        </ion-slide>
        <ion-slide>
          <div class="full-center ion-padding">
            <ion-icon name="location"></ion-icon>
            <h2>Sin resultados</h2>
            <p>
              Modifica tus ajustes de "Estoy buscando..." en tu configuración de
              perfil y añade más "Gustos frikis" para mejorar los resultados.
            </p>
            <ion-button
              shape="round"
              (click)="router.navigate(['/edit-profile'])"
              >Editar mi perfil</ion-button
            >
            <br />
            <p>
              También puedes probar suerte cambiando a la vista por kilómetros
            </p>
            <ion-button shape="round" (click)="changeView()"
              ><ion-icon name="list" slot="start" size="small"></ion-icon
              >Cambiar a vista por kilómetros</ion-button
            >
          </div>
        </ion-slide>
      </ng-template>
    </ion-slides>
  </div>
  <ng-template #listView>
    <div *ngIf="users?.length || showSkeleton; else noUsers">
      <!--<p class="ion-padding">
        Estos son los resultados obtenidos
        <span *ngIf="ratio <= 1000"> un radio de {{ ratio }}km</span><span *ngIf="ratio > 1000">mundialmente</span> con un
        porcentaje de
        coincidencia más alto.
      </p>-->
      <ion-list *ngIf="showSkeleton; else radarItems">
        <ion-item *ngFor="let i of [].constructor(8)" lines="none">
          <ion-avatar slot="start">
            <ion-skeleton-text animated></ion-skeleton-text>
          </ion-avatar>
          <ion-label>
            <h2>
              <ion-skeleton-text
                animated
                style="width: 50%"
              ></ion-skeleton-text>
            </h2>
            <h3>
              <ion-skeleton-text
                animated
                style="width: 80%"
              ></ion-skeleton-text>
            </h3>
            <p>
              <ion-skeleton-text
                animated
                style="width: 60%"
              ></ion-skeleton-text>
            </p>
          </ion-label>
        </ion-item>
      </ion-list>
      <ng-template #radarItems>
        <ion-list>
          <ion-item-sliding
            *ngFor="let user of users; "
            (ionDrag)="dragItem($event, user.id)"
          >
            <ion-item-options side="start">
              <ion-item-option (click)="showProfile(user.id)">
                <ion-icon slot="icon-only" name="heart"></ion-icon>
              </ion-item-option>
            </ion-item-options>
            <ion-item button (click)="showProfile(user.id)">
              <ion-avatar slot="start">
                <img
                  [src]="user?.thumbnail"
                  default="/assets/img/users/default.jpg"
                />
              </ion-avatar>
              <ion-label>
                <h2>
                  <span class="name">{{ user.name }}</span>
                  <span class="age">, {{ user.age }}</span>
                </h2>
                <h3>
                  <span *ngIf="user.distance !== undefined"
                    >A {{ user.distance }}km de distancia</span
                  >
                </h3>
                <p class="description">{{ user.description }}</p>
              </ion-label>
              <div class="match-list full-center" slot="end">
                {{ user.match }}%
              </div>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option
                color="danger"
                (click)="hideProfile(user.id)"
                expandable
              >
                <ion-icon slot="icon-only" name="close-circle"></ion-icon>
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
          <ion-infinite-scroll
            threshold="50%"
            (ionInfinite)="getRadarUsers($event)"
            position="bottom"
          >
            <ion-infinite-scroll-content loadingSpinner="dots">
            </ion-infinite-scroll-content>
          </ion-infinite-scroll>
        </ion-list>
      </ng-template>
    </div>
    <ng-template #noUsers>
      <div class="full-center ion-padding">
        <ion-icon name="location"></ion-icon>
        <h2>Sin resultados</h2>
        <p>
          Modifica tus ajustes de "Estoy buscando..." en tu configuración de
          perfil y añade tus "Gustos frikis" para mejorar los resultados.
        </p>
        <ion-button (click)="router.navigate(['/edit-profile'])"
          >Editar perfil</ion-button
        >
      </div>
    </ng-template>
  </ng-template>
</ion-content>
<ion-footer
  *ngIf="view === 'list'"
  [class.hide-background]="hide || showSkeleton"
>
  <div id="radar-range">
    <ion-range
      mode="md"
      #range
      min="0"
      max="5"
      step="1"
      snaps="true"
      [debounce]="250"
      value="1"
      (ionChange)="changeRatio($event.detail.value)"
    >
      <ion-label slot="start">10km</ion-label>
      <ion-icon slot="end" name="globe" size="small"></ion-icon>
    </ion-range>
    <ion-grid id="range-distance">
      <ion-row>
        <ion-col></ion-col>
        <ion-col>50km</ion-col>
        <ion-col>100km</ion-col>
        <ion-col>500km</ion-col>
        <ion-col>1000km</ion-col>
        <ion-col></ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-footer>
