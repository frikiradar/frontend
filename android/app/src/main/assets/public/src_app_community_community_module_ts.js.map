{"version":3,"file":"src_app_community_community_module_ts.js","mappings":"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","sources":["./src/app/community/community.module.ts","./src/app/community/community.page.ts","./src/app/services/animate.service.ts"],"sourcesContent":["import { CommonModule } from \"@angular/common\";\nimport { NgModule } from \"@angular/core\";\nimport { FormsModule } from \"@angular/forms\";\nimport { RouterModule, Routes } from \"@angular/router\";\nimport { IonicModule } from \"@ionic/angular\";\n\nimport { SharedModule } from \"../shared/shared.module\";\nimport { CommunityPage } from \"./community.page\";\n\nconst routes: Routes = [\n  {\n    path: \"\",\n    component: CommunityPage\n  },\n  {\n    path: \"story/:id\",\n    component: CommunityPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes),\n    SharedModule\n  ],\n  declarations: [CommunityPage]\n})\nexport class CommunityPageModule {}\n","import { Component } from \"@angular/core\";\nimport {\n  ActivatedRoute,\n  Event,\n  NavigationStart,\n  Router,\n} from \"@angular/router\";\nimport { MenuController, ModalController, Platform } from \"@ionic/angular\";\nimport { Vibration } from \"@ionic-native/vibration/ngx\";\nimport * as deepEqual from \"deep-equal\";\nimport { FirebaseX } from \"@ionic-native/firebase-x/ngx\";\nimport { AngularFireMessaging } from \"@angular/fire/compat/messaging\";\n\nimport { Room } from \"../models/room\";\nimport { Config, ConfigService } from \"../services/config.service\";\nimport { RoomService } from \"../services/room.service\";\nimport { AuthService } from \"./../services/auth.service\";\nimport { StoryService } from \"../services/story.service\";\nimport { Story } from \"../models/story\";\nimport { StoryModal } from \"../story/story-modal/story.modal\";\nimport { User } from \"../models/user\";\nimport { ViewStoriesModal } from \"../story/view-stories/view-stories.modal\";\nimport { Page } from \"../models/page\";\nimport { PageService } from \"../services/page.service\";\nimport { Chat } from \"../models/chat\";\nimport { AnimateService } from \"../services/animate.service\";\n\n@Component({\n  selector: \"app-community\",\n  templateUrl: \"./community.page.html\",\n  styleUrls: [\"./community.page.scss\"],\n})\nexport class CommunityPage {\n  public rooms: Room[];\n  public stories: Story[];\n  public pages: Page[];\n  public groupedStories: Story[] = [];\n  public loading = true;\n\n  public storiesOpts = {\n    preloadImages: false,\n    lazy: true,\n    slidesPerView: 4.5,\n    breakpoints: {\n      1024: {\n        slidesPerView: 10.5,\n      },\n    },\n    grabCursor: true,\n  };\n\n  public pagesOpts = {\n    preloadImages: false,\n    lazy: true,\n    slidesPerView: 3.5,\n    breakpoints: {\n      1024: {\n        slidesPerView: 8.5,\n      },\n    },\n    grabCursor: true,\n  };\n\n  constructor(\n    private router: Router,\n    public auth: AuthService,\n    public menu: MenuController,\n    private roomSvc: RoomService,\n    private storySvc: StoryService,\n    private config: ConfigService,\n    public vibration: Vibration,\n    private modal: ModalController,\n    private route: ActivatedRoute,\n    private pageSvc: PageService,\n    private animate: AnimateService,\n    private afMessaging: AngularFireMessaging,\n    private firebase: FirebaseX,\n    private platform: Platform\n  ) {}\n\n  async ngAfterViewInit() {\n    this.animate.animateSections(\"section\", 600, 500);\n    this.pages = (await this.config.get(\"pages\")) as Config[\"pages\"];\n    this.rooms = (await this.config.get(\"rooms\")) as Config[\"rooms\"];\n  }\n\n  async ngOnInit() {\n    this.getRooms();\n    this.getPages();\n  }\n\n  async getRooms() {\n    this.rooms = undefined;\n    let rooms = await this.roomSvc.getRooms();\n\n    const rooms_config = await this.roomSvc.getRoomsConfig();\n    rooms.map((r) => {\n      let configRoom = rooms_config?.find((room) => room.slug === r.slug);\n      if (\n        configRoom?.last_message < r?.last_message ||\n        (!configRoom?.last_message && r?.last_message)\n      ) {\n        r.unread = true;\n      }\n    });\n\n    rooms = rooms.filter((r) => {\n      if (this.auth.currentUserValue?.roles?.includes(r.permissions[0])) {\n        return r;\n      }\n    });\n\n    rooms = await this.roomSvc.orderRooms(rooms);\n\n    if (this.rooms) {\n      if (!deepEqual(this.rooms.slice(0, 3), rooms.slice(0, 3))) {\n        this.rooms = rooms;\n        this.config.set(\"rooms\", rooms);\n      }\n    } else {\n      this.rooms = rooms;\n      this.config.set(\"rooms\", rooms);\n    }\n\n    this.connectSSE();\n  }\n\n  async getPages() {\n    const pages = await this.pageSvc.getPages();\n    if (this.pages) {\n      if (!deepEqual(this.pages, pages)) {\n        this.pages = pages;\n        this.config.set(\"pages\", pages);\n      }\n    } else {\n      this.pages = pages;\n      this.config.set(\"pages\", pages);\n    }\n\n    this.loading = false;\n  }\n\n  async showAllRooms() {\n    this.router.navigate([\"/rooms\"]);\n  }\n\n  async showRoom(slug: Room[\"slug\"]) {\n    this.router.navigate([\"/room\", slug]);\n    this.rooms.map((r) => {\n      if (r.slug === slug) {\n        r.unread = false;\n      }\n    });\n  }\n\n  showPages() {\n    this.router.navigate([\"/pages\"]);\n  }\n\n  async showPage(slug: Page[\"slug\"]) {\n    this.router.navigate([\"/page\", slug]);\n  }\n\n  async connectSSE() {\n    if (this.platform.is(\"cordova\")) {\n      this.firebase.onMessageReceived().subscribe((notification) => {\n        if (notification?.message) {\n          const message = JSON.parse(notification.message) as Chat;\n          // console.log(message);\n          this.messageReceived(message);\n        }\n      });\n    } else {\n      this.afMessaging.messages.subscribe((payload: any) => {\n        if (payload?.data?.message) {\n          const message = JSON.parse(payload.data.message) as Chat;\n          console.log(message);\n          this.messageReceived(message);\n        }\n      });\n    }\n  }\n\n  async messageReceived(message: Chat) {\n    this.rooms.map((m) => {\n      if (m.slug === message.conversationId) {\n        if (message.fromuser.id !== this.auth.currentUserValue.id) {\n          m.unread = true;\n        }\n      }\n    });\n  }\n\n  openChat() {\n    this.router.navigate([\"/chat\"]);\n  }\n}\n","import { Injectable } from \"@angular/core\";\nimport { Animation, AnimationController } from \"@ionic/angular\";\n\n@Injectable({\n  providedIn: \"root\"\n})\nexport class AnimateService {\n  constructor(private animationCtrl: AnimationController) {}\n\n  animateSections(\n    selector: string,\n    duration: number,\n    delayBetweenItems: number,\n    easing?: string\n  ): void {\n    const animationArray: Animation[] = [];\n    const elemArray = document.querySelectorAll(selector);\n    for (let i = 0; i <= elemArray.length; i++) {\n      // console.log('aqui: ', elemArray[i]);\n      const animation: Animation = this.animationCtrl\n        .create()\n        .addElement(elemArray[i])\n        .easing(easing ? easing : \"cubic-bezier(0.55, 0, 1, 0.45)\")\n        .duration(duration)\n        .delay(i * delayBetweenItems)\n        .fromTo(\"opacity\", \"0\", \"1\");\n      // .fromTo(\"width\", \"0\", \"100%\");\n      animationArray.push(animation);\n    }\n    animationArray.forEach((animation: Animation) => {\n      animation.play();\n    });\n  }\n}\n"],"names":[],"sourceRoot":"webpack:///"}